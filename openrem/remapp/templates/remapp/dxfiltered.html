{% extends "remapp/filteredbase.html" %}

{% block navdx %}<li class="active">{% endblock %}

{% block toprow %}
  {% load pagination_tags %}

  <p>
    There are {{ filter.count }} studies in this list.
  </p>

{% endblock %}

{% block col2 %}
  <div class="panel panel-info">
  <div class="panel-heading">
      <h3 class="panel-title">Data export</h3>
  </div>
  <div class="panel-body">
    {% if admin.exportgroup %}
        <p><strong>Note:</strong> Apply the exam filter first to refine what is exported.</p>
    <p>
      <a href="/openrem/exportctcsv1/0/0/?{{ request.GET.urlencode }}"
             class="btn btn-default btn-sm" role="button">Export to CSV&nbsp;</a>
          {% if admin.pidgroup %}
              <a href="/openrem/exportdxcsv1/1/0/?{{ request.GET.urlencode }}"
                 class="btn btn-default btn-sm" role="button">With names</a>
              <a href="/openrem/exportdxcsv1/0/1/?{{ request.GET.urlencode }}"
                 class="btn btn-default btn-sm" role="button">With ID</a>
              <a href="/openrem/exportdxcsv1/1/1/?{{ request.GET.urlencode }}"
                 class="btn btn-default btn-sm" role="button">With both</a>
          {% endif %}
    </p>
    <p>
          <a href="/openrem/exportdxxlsx1/0/0/?{{ request.GET.urlencode }}"
             class="btn btn-default btn-sm" role="button">Export to XLSX</a>
          {% if admin.pidgroup %}
              <a href="/openrem/exportdxxlsx1/1/0/?{{ request.GET.urlencode }}"
                 class="btn btn-default btn-sm" role="button">With names</a>
              <a href="/openrem/exportdxxlsx1/0/1/?{{ request.GET.urlencode }}"
                 class="btn btn-default btn-sm" role="button">With ID</a>
              <a href="/openrem/exportdxxlsx1/1/1/?{{ request.GET.urlencode }}"
                 class="btn btn-default btn-sm" role="button">With both</a>
          {% endif %}
    </p>

  {% else %}
    <p>
      No export permissions
    </p>
  {% endif %}


  </div>
  </div>


  {{ studyfilter }}

  <form action="{% url "dx_summary" %}" method="get" class="form-horizontal" role="form" id="examFilterForm">
    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">Exam filter</h3>
      </div>
      <div class="panel-body">
        <i>Date format yyyy-mm-dd</i>
        {% for field in filter.form.visible_fields %}
          <div class="form-group">
            <div class="col-xs-4">
              <label>{{ field.label_tag }}</label>
            </div>
            <div class="col-xs-8">
              {{ field.errors }}
              {{ field }}
            </div>
          </div>
        {% endfor %}
        {% for field in filter.form.hidden_fields %}
          <div style="display:none">{{ field }}</div>
        {% endfor %}
        <input name="submit" type="submit" />
      <!--<input type="button" value="post" id="postData">-->
      </div>
      <div class="panel-heading">
        <h3 class="panel-title">Chart options</h3>
      </div>
      <div class="panel-body">
        <table>
          {% csrf_token %}
          {{ chartOptionsForm }}
        </table>
        <input name="submit" type="submit" id="examFilterFormSubmit" />
        <!--<input type="button" value="post" id="postData">-->

      </div>
    </div>
  </form>

  <script src="{{ STATIC_URL }}js/datepicker.js"></script>
  <script src="{{ STATIC_URL }}js/formatDate.js"></script>
  <script src="{{ STATIC_URL }}js/getColours.js"></script>

{% endblock %}


{% block col1 %}
  {% autopaginate filter.qs 50 as filter_list %}
  {% paginate %}

  <table class="table table-bordered table-hover row-clickable">
    <row>
      <th>Institution</th><th>Make | Model | Display name</th><th>Date</th><th>Study description | Accession number</th><th>Number of events</th><th>Total DAP (cGy.cm<sup>2</sup>)</th>
      {% if admin.admingroup %}
        <th>Delete?</th>
      {% endif %}
    </row>
    {% for exam in filter_list %}
      <tr>
        <td>
          <a href="/openrem/dx/{{ exam.id }}/">
            {{ exam.generalequipmentmoduleattr_set.get.institution_name }}
          </a>
        </td>
        <td>
          <a href="/openrem/dx/{{ exam.id }}/">
            {{ exam.generalequipmentmoduleattr_set.get.manufacturer }} |
            {{ exam.generalequipmentmoduleattr_set.get.manufacturer_model_name }} |
            {{ exam.generalequipmentmoduleattr_set.get.unique_equipment_name.display_name }}
          </a>
        </td>
        <td>
          <a href="/openrem/dx/{{ exam.id }}/">
            {{ exam.study_date|date:"Y-m-d" }} {{ exam.study_time|date:"H:i" }}
          </a>
        </td>
        <td>
          <a href="/openrem/dx/{{ exam.id }}/">
            {{ exam.study_description }} |
              {% if not exam.accession_hashed %}
                {{ exam.accession_number }}
              {% endif %}
          </a>
        </td>
        <td>
          <a href="/openrem/dx/{{ exam.id }}/">
            {{ exam.projectionxrayradiationdose_set.get.accumxraydose_set.get.accumintegratedprojradiogdose_set.get.total_number_of_radiographic_frames }}
          </a>
        </td>
        <td>
          <a href="/openrem/dx/{{ exam.id }}/">
            {{ exam.projectionxrayradiationdose_set.get.accumxraydose_set.get.accumintegratedprojradiogdose_set.get.convert_gym2_to_cgycm2 | floatformat:1 }}
          </a>
        </td>
        {% if admin.admingroup %}
          <td>
            <a href="{% url 'study_delete' exam.id %}">Delete</a>
          </td>
        {% endif %}
      </tr>
    {% endfor %}
  </table>

  {% paginate %}
{% endblock %}

{% block plotdata %}
  {% if request.user.userprofile.plotCharts %}

      <div class="ajax-progress"><img src="{{ STATIC_URL }}img/ajax-loader.gif"></div>

    {% if request.user.userprofile.plotDXAcquisitionMeanDAP %}
      <!-- HTML to include div container for acquisition plot -->
      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="setTimeout(function() {$(document).resize();}, 0);">
                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                Plot of mean DAP for each acquisition protocol.
                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                Plot of median DAP for each acquisition protocol.
                {% else %}
                Plot of mean and median DAP for each acquisition protocol.
                {% endif %}
              </a>
            </h4>
          </div>
          <div id="collapseOne" class="panel-collapse collapse">
            <div class="panel-body">
              <div id="container" style="height: auto; margin: 0 0"></div>

              <table style="border:none">
                  <tr>
                      <th colspan="3" style="padding: 0px; padding-right: 10px; vertical-align: top">Sorting options</th>
                      <td rowspan="3" style="padding-left: 20px; vertical-align: top">Click on an individual column to show a histogram of data for that acquisition protocol.<br>
                          Click on a histogram bin tooltip to see the studies that contain the acquisitions in the bin. Note that
                          this will include acquisitions at the upper bin boundary, so in some cases may display more data than
                          shown in the histogram bin.</td>
                  </tr>
                  <tr>
              {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#container', 'y', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending DLP">&uarr;DAP</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#container', 'freq', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending frequency">&uarr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#container', 'name', 1)" class="sorting-option" data-toggle="tooltip" title="Sort alphabetically">A&nbsp;to&nbsp;Z</a></td>
              {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#container', 'y', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending DLP">&uarr;DAP</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#container', 'freq', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending frequency">&uarr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#container', 'name', 1)" class="sorting-option" data-toggle="tooltip" title="Sort alphabetically">A&nbsp;to&nbsp;Z</a></td>
              {% else %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#container', 'y', 1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending DLP">&uarr;DAP</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#container', 'freq', 1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending frequency">&uarr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="twoSeriesSort('#container', 'name', 1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort alphabetically">A&nbsp;to&nbsp;Z</a></td>
              {% endif %}
                  </tr>
                  <tr>
              {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#container', 'y', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending DAP">&darr;DAP</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#container', 'freq', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending frequency">&darr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#container', 'name', -1)" class="sorting-option" data-toggle="tooltip" title="Sort reverse alphabetically">Z&nbsp;to&nbsp;A</a></td>
              {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#container', 'y', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending DAP">&darr;DAP</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#container', 'freq', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending frequency">&darr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#container', 'name', -1)" class="sorting-option" data-toggle="tooltip" title="Sort reverse alphabetically">Z&nbsp;to&nbsp;A</a></td>
              {% else %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#container', 'y', -1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort by descending DAP">&darr;DAP</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#container', 'freq', -1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort by descending frequency">&darr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="twoSeriesSort('#container', 'name', -1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort reverse alphabetically">Z&nbsp;to&nbsp;A</a></td>
              {% endif %}
                  </tr>
              </table>

            </div>
          </div>
        </div>
      </div>
      <!-- End of HTML to include div for acquisition plot -->
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionFreq %}
      <!-- HTML to include div container for acquisition pie chart -->
      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseProtocolPieChart" onclick="setTimeout(function() {$(document).resize();}, 0);">
                Pie chart showing a breakdown of acquisition protocol frequency.
              </a>
            </h4>
          </div>
          <div id="collapseProtocolPieChart" class="panel-collapse collapse">
            <div class="panel-body">
              <div id="piechartProtocolDIV" style="height: auto; margin: 0 0"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- End of HTML to include div container for acquisition pie chart -->
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionMeankVp %}
      <!-- HTML to include div container for mean kVp per acquisition chart -->
      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseAcquisitionMeankVpChart" onclick="setTimeout(function() {$(document).resize();}, 0);">
                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                Plot of mean kVp for each acquisition protocol.
                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                Plot of median kVp for each acquisition protocol.
                {% else %}
                Plot of mean and median kVp for each acquisition protocol.
                {% endif %}
              </a>
            </h4>
          </div>
          <div id="collapseAcquisitionMeankVpChart" class="panel-collapse collapse">
            <div class="panel-body">
              <div id="chartAcquisitionMeankVp" style="height: auto; margin: 0 0"></div>

              <table style="border:none">
                  <tr>
                      <th colspan="3" style="padding: 0px; padding-right: 10px; vertical-align: top">Sorting options</th>
                      <td rowspan="3" style="padding-left: 20px; vertical-align: top">Click on an individual column to show a histogram of data for that acquisition protocol.</td>
                  </tr>
                  <tr>
              {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'y', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending kVp">&uarr;kVp</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'freq', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending frequency">&uarr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'name', 1)" class="sorting-option" data-toggle="tooltip" title="Sort alphabetically">A&nbsp;to&nbsp;Z</a></td>
              {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'y', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending kVp">&uarr;kVp</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'freq', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending frequency">&uarr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'name', 1)" class="sorting-option" data-toggle="tooltip" title="Sort alphabetically">A&nbsp;to&nbsp;Z</a></td>
              {% else %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeankVp', 'y', 1,0 )" class="sorting-option" data-toggle="tooltip" title="Sort by ascending kVp">&uarr;kVp</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeankVp', 'freq', 1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending frequency">&uarr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeankVp', 'name', 1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort alphabetically">A&nbsp;to&nbsp;Z</a></td>
              {% endif %}
                  </tr>
                  <tr>
              {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'y', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending kVp">&darr;kVp</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'freq', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending frequency">&darr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'name', -1)" class="sorting-option" data-toggle="tooltip" title="Sort reverse alphabetically">Z&nbsp;to&nbsp;A</a></td>
              {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'y', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending kVp">&darr;kVp</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'freq', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending frequency">&darr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeankVp', 'name', -1)" class="sorting-option" data-toggle="tooltip" title="Sort reverse alphabetically">Z&nbsp;to&nbsp;A</a></td>
              {% else %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeankVp', 'y', -1,0 )" class="sorting-option" data-toggle="tooltip" title="Sort by descending kVp">&darr;kVp</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeankVp', 'freq', -1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort by descending frequency">&darr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeankVp', 'name', -1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort reverse alphabetically">Z&nbsp;to&nbsp;A</a></td>
              {% endif %}
                  </tr>
              </table>

            </div>
          </div>
        </div>
      </div>
      <!-- End of HTML to include div container for mean kVp per acquisition chart -->
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionMeanmAs %}
      <!-- HTML to include div container for mean mAs per acquisition chart -->
      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseAcquisitionMeanmAsChart" onclick="setTimeout(function() {$(document).resize();}, 0);">
                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                Plot of mean mAs for each acquisition protocol.
                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                Plot of median mAs for each acquisition protocol.
                {% else %}
                Plot of mean and median mAs for each acquisition protocol.
                {% endif %}
              </a>
            </h4>
          </div>
          <div id="collapseAcquisitionMeanmAsChart" class="panel-collapse collapse">
            <div class="panel-body">
              <div id="chartAcquisitionMeanmAs" style="height: auto; margin: 0 0"></div>

              <table style="border:none">
                  <tr>
                      <th colspan="3" style="padding: 0px; padding-right: 10px; vertical-align: top">Sorting options</th>
                      <td rowspan="2" style="padding-left: 20px; vertical-align: top">Click on an individual column to show a histogram of data for that acquisition protocol.</td>
                  </tr>
                  <tr>
              {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'y', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending mAs">&uarr;mAs</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'freq', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending frequency">&uarr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'name', 1)" class="sorting-option" data-toggle="tooltip" title="Sort alphabetically">A&nbsp;to&nbsp;Z</a></td>
              {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'y', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending mAs">&uarr;mAs</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'freq', 1)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending frequency">&uarr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'name', 1)" class="sorting-option" data-toggle="tooltip" title="Sort alphabetically">A&nbsp;to&nbsp;Z</a></td>
              {% else %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeanmAs', 'y', 1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending mAs">&uarr;mAs</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeanmAs', 'freq', 1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort by ascending frequency">&uarr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeanmAs', 'name', 1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort alphabetically">A&nbsp;to&nbsp;Z</a></td>
              {% endif %}
                  </tr>
                  <tr>
              {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'y', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending mAs">&darr;mAs</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'freq', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending frequency">&darr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'name', -1)" class="sorting-option" data-toggle="tooltip" title="Sort reverse alphabetically">Z&nbsp;to&nbsp;A</a></td>
              {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'y', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending mAs">&darr;mAs</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'freq', -1)" class="sorting-option" data-toggle="tooltip" title="Sort by descending frequency">&darr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="seriesSort('#chartAcquisitionMeanmAs', 'name', -1)" class="sorting-option" data-toggle="tooltip" title="Sort reverse alphabetically">Z&nbsp;to&nbsp;A</a></td>
              {% else %}
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeanmAs', 'y', -1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort by descending mAs">&darr;mAs</a></td>
                      <td style="padding: 0px; padding-right: 10px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeanmAs', 'freq', -1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort by descending frequency">&darr;frequency</a></td>
                      <td style="padding: 0px; vertical-align: top"><a onclick="twoSeriesSort('#chartAcquisitionMeanmAs', 'name', -1, 0)" class="sorting-option" data-toggle="tooltip" title="Sort reverse alphabetically">Z&nbsp;to&nbsp;A</a></td>
              {% endif %}
                  </tr>
              </table>

            </div>
          </div>
        </div>
      </div>
      <!-- End of HTML to include div container for mean mAs per acquisition chart -->
    {% endif %}

    {% if request.user.userprofile.plotDXStudyPerDayAndHour %}
      <!-- HTML to include div container for mean acquisition protocol DAP per week -->
      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseStudyWorkloadPieChart" onclick="setTimeout(function() {$(document).resize();}, 0);">
                Pie chart showing a breakdown of number of studies per weekday.
              </a>
            </h4>
          </div>
          <div id="collapseStudyWorkloadPieChart" class="panel-collapse collapse">
            <div class="panel-body">
              <div id="piechartStudyWorkloadDIV" style="height: auto; margin: 0 0"></div>
              <p>Click on a segment to be taken to a pie chart showing the breakdown per hour for that weekday.</p>
            </div>
          </div>
        </div>
      </div>
      <!-- End of HTML to include div container for studies per week day pie chart -->
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionMeankVpOverTime %}
      <!-- HTML to include div container for mean acquisition protocol kVp over time -->
      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseAcquisitionMeankVpOverTime" onclick="setTimeout(function() {$(document).resize();}, 0);">
                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                Line plot showing mean kVp of each acquisition protocol over time ({{ request.user.userprofile.plotDXAcquisitionMeanDAPOverTimePeriod }}).
                {% else %}
                Line plot showing median kVp of each acquisition protocol over time ({{ request.user.userprofile.plotDXAcquisitionMeanDAPOverTimePeriod }}).
                {% endif %}
              </a>
            </h4>
          </div>
          <div id="collapseAcquisitionMeankVpOverTime" class="panel-collapse collapse">
            <div class="panel-body">
              <div id="AcquisitionMeankVpOverTimeDIV" style="height: auto; margin: 0 0"></div>
              <p>Click on the legend entries to show or hide the corresponding series. Click and drag the mouse over a date range to zoom in.</p>
            </div>
          </div>
        </div>
      </div>
      <!-- End of HTML to include div container for mean acquisition protocol kVp over time -->
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionMeanmAsOverTime %}
      <!-- HTML to include div container for mean acquisition protocol mAs over time -->
      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseAcquisitionMeanmAsOverTime" onclick="setTimeout(function() {$(document).resize();}, 0);">
                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                Line plot showing mean mAs of each acquisition protocol over time ({{ request.user.userprofile.plotDXAcquisitionMeanDAPOverTimePeriod }}).
                {% else %}
                Line plot showing median mAs of each acquisition protocol over time ({{ request.user.userprofile.plotDXAcquisitionMeanDAPOverTimePeriod }}).
                {% endif %}
              </a>
            </h4>
          </div>
          <div id="collapseAcquisitionMeanmAsOverTime" class="panel-collapse collapse">
            <div class="panel-body">
              <div id="AcquisitionMeanmAsOverTimeDIV" style="height: auto; margin: 0 0"></div>
              <p>Click on the legend entries to show or hide the corresponding series. Click and drag the mouse over a date range to zoom in.</p>
            </div>
          </div>
        </div>
      </div>
      <!-- End of HTML to include div container for mean acquisition protocol mAs over time -->
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionMeanDAPOverTime %}
      <!-- HTML to include div container for mean acquisition protocol DAP per week -->
      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseAcquisitionMeanDAPOverTime" onclick="setTimeout(function() {$(document).resize();}, 0);">
                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                Line plot showing mean DAP of each acquisition protocol over time ({{ request.user.userprofile.plotDXAcquisitionMeanDAPOverTimePeriod }}).
                {% else %}
                Line plot showing median DAP of each acquisition protocol over time ({{ request.user.userprofile.plotDXAcquisitionMeanDAPOverTimePeriod }}).
                {% endif %}
              </a>
            </h4>
          </div>
          <div id="collapseAcquisitionMeanDAPOverTime" class="panel-collapse collapse">
            <div class="panel-body">
              <div id="AcquisitionMeanDAPOverTimeDIV" style="height: auto; margin: 0 0"></div>
              <p>Click on the legend entries to show or hide the corresponding series. Click and drag the mouse over a date range to zoom in.</p>
            </div>
          </div>
        </div>
      </div>
      <!-- End of HTML to include div container for mean acquisition protocol DAP per week -->
    {% endif %}

    <!-- Include JavaScript to enable highcharts plots -->
    <script src="{{ STATIC_URL }}js/highcharts.js"></script>
    <script src="{{ STATIC_URL }}js/exporting.js"></script>
    <script src="{{ STATIC_URL }}js/export-csv.js"></script>
    <script src="{{ STATIC_URL }}js/drilldown.js"></script>
    <script src="{{ STATIC_URL }}js/chartSortingRoutines.js"></script>
    <script>
        var chartSorting = '{{ request.user.userprofile.plotDXInitialSortingChoice }}';
        var chartSortingDirection = {{ request.user.userprofile.plotInitialSortingDirection }};
    </script>
    <!-- End of include JavaScript for the plots -->

    <!-- JavaScript to enable bootstrap tooltips -->
    <script>
        $(document).ready(function(){
            $('[data-toggle="tooltip"]').tooltip();
        });
    </script>
    <!-- End of JavaScript to enable bootstrap tooltips -->

    <!-- JavaScript function to sort a list of objects by the 'y' or 'name' object. -->
    <script src="{{ STATIC_URL }}js/sorting.js"></script>
    <!-- End of JavaScript function to sort a list of objects by the 'y' or 'name' object -->

    <!-- JavaScript chart AJAX code. -->
    <script src="{{ STATIC_URL }}js/dxChartAjax.js"></script>
    <!-- End of JavaScript chart AJAX code. -->

    <!-- Flags to determine if charts should be plotted -->
    {% if request.user.userprofile.plotDXAcquisitionMeanDAP %}
    <script>var plotDXAcquisitionMeanDAP = true;</script>
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionFreq %}
    <script>var plotDXAcquisitionFreq = true;</script>
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionMeanDAPOverTime %}
    <script>var plotDXAcquisitionMeanDAPOverTime = true;</script>
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionMeankVpOverTime %}
    <script>var plotDXAcquisitionMeankVpOverTime = true;</script>
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionMeanmAsOverTime %}
    <script>var plotDXAcquisitionMeanmAsOverTime = true;</script>
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionMeankVp %}
    <script>var plotDXAcquisitionMeankVp = true;</script>
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionMeanmAs %}
    <script>var plotDXAcquisitionMeanmAs = true;</script>
    {% endif %}

    {% if request.user.userprofile.plotDXStudyPerDayAndHour %}
    <script>var plotDXStudyPerDayAndHour = true;</script>
    {% endif %}

    <script>var plotDXAcquisitionMeanDAPOverTimePeriod = '{{ request.user.userprofile.plotDXAcquisitionMeanDAPOverTimePeriod }}';</script>

    <script>var plotAverageChoice = '{{ request.user.userprofile.plotAverageChoice }}';</script>

      {% if request.user.userprofile.plotDXAcquisitionMeanDAP %}
          <script>
              var tooltipFilters = '{% for field in filter.form %}{% if field.name != 'acquisition_dap_min' and field.name != 'acquisition_dap_max' and field.name != 'acquisition_protocol' and field.name != 'o' and field.value %}&{{ field.name }}={{ field.value }}{% endif %}{% endfor %}';
          </script>

          {% if request.user.userprofile.plotAverageChoice == 'both' %}
              <script src="{{ STATIC_URL }}js/dxChartDAPperAcquisitionMeanAndMedian.js"></script>
          {% elif request.user.userprofile.plotAverageChoice == 'mean' %}
              <script src="{{ STATIC_URL }}js/dxChartDAPperAcquisitionMean.js"></script>
          {% else %}
              <script src="{{ STATIC_URL }}js/dxChartDAPperAcquisitionMedian.js"></script>
          {% endif %}
          <!-- End of JavaScript for acquisition plot -->
      {% endif %}


    {% if request.user.userprofile.plotDXAcquisitionFreq or request.user.userprofile.plotDXAcquisitionMeankVpOverTime or request.user.userprofile.plotDXAcquisitionMeanmAsOverTime or request.user.userprofile.plotDXAcquisitionMeanDAPOverTime%}
      <!-- JavaScript for acquisition pie chart. protocolColours also needed by plot of DAP over time -->
      <script>
        var urlStartAcq = '/openrem/dx/?{% for field in filter.form %}{% if field.name != 'acquisition_protocol' and field.name != 'o' and field.value %}&{{ field.name }}={{ field.value }}{% endif %}{% endfor %}&acquisition_protocol=';
      </script>
    {% endif %}

    {% if request.user.userprofile.plotDXAcquisitionFreq %}
      <script src="{{ STATIC_URL }}js/dxChartAcquisitionFrequency.js"></script>
      <!-- End of JavaScript for acquisition pie chart -->
    {% endif %}


    {% if request.user.userprofile.plotDXAcquisitionMeankVp %}
        <!-- JavaScript for acquisition mean kVp plot -->
        <script>
            var tooltipFilterskVp = '{% for field in filter.form %}{% if field.name != 'acquisition_kvp_min' and field.name != 'acquisition_kvp_max' and field.name != 'acquisition_protocol' and field.name != 'o' and field.value %}&{{ field.name }}={{ field.value }}{% endif %}{% endfor %}';
        </script>

      {% if request.user.userprofile.plotAverageChoice == 'both' %}
          <script src="{{ STATIC_URL }}js/dxChartkVpPerAcquisitionMeanAndMedian.js"></script>
      {% elif request.user.userprofile.plotAverageChoice == 'mean' %}
          <script src="{{ STATIC_URL }}js/dxChartkVpPerAcquisitionMean.js"></script>
      {% else %}
          <script src="{{ STATIC_URL }}js/dxChartkVpPerAcquisitionMedian.js"></script>
      {% endif %}
      <!-- End of JavaScript for acquisition mean kVp plot -->
    {% endif %}


    {% if request.user.userprofile.plotDXAcquisitionMeanmAs %}
      <!-- JavaScript for acquisition mean mAs plot -->
      <script>
        var tooltipFiltersmAs = '{% for field in filter.form %}{% if field.name != 'acquisition_mas_min' and field.name != 'acquisition_mas_max' and field.name != 'acquisition_protocol' and field.name != 'o' and field.value %}&{{ field.name }}={{ field.value }}{% endif %}{% endfor %}';
      </script>

      {% if request.user.userprofile.plotAverageChoice == 'both' %}
          <script src="{{ STATIC_URL }}js/dxChartmAsPerAcquisitionMeanAndMedian.js"></script>
      {% elif request.user.userprofile.plotAverageChoice == 'mean' %}
          <script src="{{ STATIC_URL }}js/dxChartmAsPerAcquisitionMean.js"></script>
      {% else %}
          <script src="{{ STATIC_URL }}js/dxChartmAsPerAcquisitionMedian.js"></script>
      {% endif %}
      <!-- End of JavaScript for acquisition mean mAs plot -->
    {% endif %}


    {% if request.user.userprofile.plotDXStudyPerDayAndHour %}
      <!-- JavaScript for studies per weekday pie chart with drilldown to hourly breakdown -->
      <script src="{{ STATIC_URL }}js/dxChartStudyWorkload.js"></script>
      <!-- End of JavaScript for studies per week day pie chart -->
    {% endif %}


    {% if request.user.userprofile.plotDXAcquisitionMeankVpOverTime %}
      <!-- JavaScript for mean kvp per acquisition protocol per time period -->
      {% if request.user.userprofile.plotAverageChoice == 'mean' %}
      <script src="{{ STATIC_URL }}js/dxChartMeankVpperAcquisitionOverTime.js"></script>
      {% else %}
      <script src="{{ STATIC_URL }}js/dxChartMediankVpperAcquisitionOverTime.js"></script>
      {% endif %}
      <!-- End of JavaScript for mean kVp per acquisition protocol per time period -->
    {% endif %}


    {% if request.user.userprofile.plotDXAcquisitionMeanmAsOverTime %}
      <!-- JavaScript for mean mAs per acquisition protocol per time period -->
      {% if request.user.userprofile.plotAverageChoice == 'mean' %}
      <script src="{{ STATIC_URL }}js/dxChartMeanmAsperAcquisitionOverTime.js"></script>
      {% else %}
      <script src="{{ STATIC_URL }}js/dxChartMedianmAsperAcquisitionOverTime.js"></script>
      {% endif %}
      <!-- End of JavaScript for mean mAs per acquisition protocol per time period -->
    {% endif %}


    {% if request.user.userprofile.plotDXAcquisitionMeanDAPOverTime %}
      <!-- JavaScript for mean DAP per acquisition protocol per time period -->
      {% if request.user.userprofile.plotAverageChoice == 'mean' %}
      <script src="{{ STATIC_URL }}js/dxChartMeanDAPperAcquisitionOverTime.js"></script>
      {% else %}
      <script src="{{ STATIC_URL }}js/dxChartMedianDAPperAcquisitionOverTime.js"></script>
      {% endif %}
      <!-- End of JavaScript for mean DAP per acquisition protocol per time period -->
    {% endif %}


  {% endif %}
{% endblock %}
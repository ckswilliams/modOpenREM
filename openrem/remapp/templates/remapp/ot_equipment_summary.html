{% extends "remapp/base.html" %}

{% block headextras %}
  <script src="{{ STATIC_URL }}js/sorttable.js"></script>
{% endblock %}

{% block confnav %}
  <li class="dropdown active">{% endblock %}

{% block navhelp %}
  <li>
    <a href="http://docs.openrem.org/en/{{ admin.docsversion }}/i_displaynames.html" target="_blank"
       data-toggle="tooltip" title="Display name documentation - opens in a new tab">
      Display name documentation
    </a>
  </li>
{% endblock %}

{% block toprow %}

  {% load pagination_tags %}

  <p>The entry in the unique equipment names table for these {{ modality }} studies looks like this
  </p>

  <table class="table table-bordered">
    <tr>
      <th>Display name</th>
      <th>User defined modality</th>
      <th>Institution</th>
      <th>Department</th>
      <th>Manufacturer</th>
      <th>Model</th>
      <th>Station name</th>
      <th>Serial no.</th>
      <th>Software version</th>
      <th>Gantry ID</th>
    </tr>
    <tr>
      <td>{{ equipment.display_name }}</td>
      <td>{{ equipment.user_defined_modality }}</td>
      <td>{{ equipment.institution_name }}</td>
      <td>{{ equipment.institutional_department_name }}</td>
      <td>{{ equipment.manufacturer }}</td>
      <td>{{ equipment.manufacturer_model_name }}</td>
      <td>{{ equipment.station_name }}</td>
      <td>{{ equipment.device_serial_number }}</td>
      <td>{{ equipment.software_versions }}</td>
      <td>{{ equipment.gantry_id }}</td>
    </tr>
  </table>

  <p>
    There are {{ studies.count }} studies in this list.
    {% if modality == "OT" %}
      This list is of studies that are not identified as being CT, fluoroscopy, mammography or radiography (DX and CR).
      The total number of studies associated with this equipment (before filtering out the modalities) is
      {{ count_all }}.
    {% endif %}
  </p>

{% endblock %}


{% block mainblock %}

  <table class="table table-bordered">
    <tr>
      <th>Date</th>
      <th>Time</th>
      <th>Patient module?</th>
      <th>Patient study module?</th>
      <th>CT template</th>
      <th>CT accumulated data</th>
      <th>CT event data</th>
      <th>X-ray Template</th>
      <th>X-ray Accumulated data</th>
      <th>Accum. fluoro and projection</th>
      <th>Accum. mammography</th>
      <th>Accum. cassette based projection</th>
      <th>Accum. projection</th>
      <th>Irradiation event data</th>
      <th>Irradiation detector data</th>
      <th>Irradiation source data</th>
      <th>Irradiation mechanical data</th>
    </tr>
    {% for study in studies %}

      <tr>
        <td>{{ study.study_date }}</td>
        <td>{{ study.study_time }}</td>
        <td>
          {% if study.patientmoduleattr_set.get %}
            Present
          {% else %}
            Missing
          {% endif %}
        </td>
        <td>
          {% if study.patientstudymoduleattr_set %}
            Present. Age {{ study.patientstudymoduleattr_set.get.patient_age_decimal|floatformat:1 }}
          {% else %}
            Missing
          {% endif %}
        </td>
        <td>
          {% if study.ctradiationdose_set.get %}
            Present
          {% else %}
            None
          {% endif %}
        </td>
        <td>
          {% if study.ctradiationdose_set.get.ctaccumulateddosedata_set %}
            Yes, number of events:
            {{ study.ctradiationdose_set.get.ctaccumulateddosedata_set.get.total_number_of_irradiation_events }}
          {% else %}
            None
          {% endif %}
        </td>
        <td>
          {% if study.ctradiationdose_set.get.ctirradiationeventdata_set.all.count %}
            {{ study.ctradiationdose_set.get.ctirradiationeventdata_set.all.count }} event(s)
          {% else %}
            None
          {% endif %}
        </td>
      <td>
        {% if study.projectionxrayradiationdose_set.get %}
        Present
        {% else %}
        None
        {% endif %}
      </td>
      </tr>

    {% endfor %}
  </table>
{% endblock %}